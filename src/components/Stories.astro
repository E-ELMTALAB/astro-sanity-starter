---
import Section from '@components/Section.astro';
import type { StoriesSection } from 'types';

interface Props extends StoriesSection {
    'data-sb-field-path'?: string;
}

const { heading, items, 'data-sb-field-path': fieldPath, ...rest } = Astro.props;
const stories = Array.isArray(items) ? items : [];
---

{(heading || stories.length) ? (
    <Section {...rest} data-sb-field-path={fieldPath} class="space-y-6">
        {heading && (
            <h2 class="text-3xl font-bold" data-sb-field-path=".heading">
                {heading}
            </h2>
        )}
        {stories.length ? (
            <div class="grid grid-cols-1 gap-6 md:grid-cols-2 xl:grid-cols-3" data-sb-field-path=".items">
                {stories.map((story, idx) => (
                    <article
                        class="space-y-4 rounded-2xl border border-base-200 bg-base-100 p-6 shadow-sm"
                        data-sb-field-path={`.${idx}`}
                    >
                        {story?.cover?.src && (
                            <div class="overflow-hidden rounded-xl" data-sb-field-path=".cover">
                                <img
                                    src={story.cover.src}
                                    alt={story.cover.alt}
                                    class="h-48 w-full object-cover"
                                    loading="lazy"
                                    data-sb-object-id={story.cover._id}
                                />
                            </div>
                        )}
                        {story?.name && (
                            <h3 class="text-xl font-semibold" data-sb-field-path=".name">
                                {story.name}
                            </h3>
                        )}
                        {Array.isArray(story?.slides) && story.slides.length ? (
                            <ul class="space-y-3 text-sm" data-sb-field-path=".slides">
                                {story.slides.map((slide, slideIdx) => (
                                    <li
                                        class="space-y-2 rounded-lg border border-base-200 bg-base-200/30 p-3"
                                        data-sb-field-path={`.${slideIdx}`}
                                    >
                                        {slide?.image?.src && (
                                            <div class="overflow-hidden rounded-lg" data-sb-field-path=".image">
                                                <img
                                                    src={slide.image.src}
                                                    alt={slide.image.alt}
                                                    class="h-32 w-full object-cover"
                                                    loading="lazy"
                                                    data-sb-object-id={slide.image._id}
                                                />
                                            </div>
                                        )}
                                        {slide?.text && (
                                            <p data-sb-field-path=".text">{slide.text}</p>
                                        )}
                                        {typeof slide?.duration === 'number' && (
                                            <p class="text-xs opacity-70" data-sb-field-path=".duration">
                                                {slide.duration} ms
                                            </p>
                                        )}
                                    </li>
                                ))}
                            </ul>
                        ) : null}
                    </article>
                ))}
            </div>
        ) : null}
    </Section>
) : null}
